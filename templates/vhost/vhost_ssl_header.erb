server {
  listen <%= @ssl_listen_ip %>:<%= @ssl_listen_port %><% if @bool_default_server %> default_server<% end %>;
  <% if @bool_ipv6_enable && (defined? @ipaddress6) %>listen [<%= @ipv6_listen_ip %>]:<%= @ipv6_listen_port %> default ipv6only=on;<% end %>
  server_name <%= @server_name %> <%= @server_aliases %>;
  access_log <%= scope.lookupvar('nginx::log_dir')%>/<%= @name %>.access.log;

  ssl on;
  ssl_certificate         <%= @ssl_cert %>;
  ssl_certificate_key     <%= @ssl_key %>;
<% unless @ssl_client_cert.nil? || @ssl_client_cert.empty? -%>
  ssl_client_certificate  <%= @ssl_client_cert %>;
<% end -%>
<% unless @ssl_verify_client.nil? || @ssl_verify_client.empty? -%>
  ssl_verify_client       <%= @ssl_verify_client %>;
<% end -%>

  ssl_session_timeout     5m;

  ssl_prefer_server_ciphers on;
  ssl_protocols           TLSv1 TLSv1.1 TLSv1.2; # not possible to do exclusive
  ssl_ciphers             'EDH+CAMELLIA:EDH+aRSA:EECDH+aRSA+AESGCM:EECDH+aRSA+SHA384:EECDH+aRSA+SHA256:EECDH:+CAMELLIA256:+AES256:+CAMELLIA128:+AES128:+SSLv3:!aNULL:!eNULL:!LOW:!3DES:!MD5:!EXP:!PSK:!DSS:!RC4:!SEED:!ECDSA:CAMELLIA256-SHA:AES256-SHA:CAMELLIA128-SHA:AES128-SHA';

  add_header Strict-Transport-Security max-age=15768000; # six months
  # use this only if all subdomains support HTTPS!
  # add_header Strict-Transport-Security "max-age=15768000; includeSubDomains";
